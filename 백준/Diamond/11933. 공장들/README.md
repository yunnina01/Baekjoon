# [Diamond IV] 공장들 - 11933 

[문제 링크](https://www.acmicpc.net/problem/11933) 

### 성능 요약

메모리: 420940 KB, 시간: 10196 ms

### 분류

센트로이드, 센트로이드 분할, 분할 정복, 최소 공통 조상, 트리

### 제출 일자

2025년 4월 21일 06:04:23

### 문제 설명

<p>IOI 왕국에서 0 이상 N−1 이하의 번호가 붙은 N개의 도시들이 있습니다. 이들 도시들은 양방향으로 통행이 가능한 N−1개의 도로로 연결되어 있습니다. 여러분은 이러한 도로들을 몇 개 통과하여 어떤 서로 다른 두 다시 사이도 이동할 수 있습니다.</p>

<p>IOI 왕국에는 특별한 제품들을 생산하는 많은 회사들이 있습니다. 각 회사는 단 한 종류의 제품만 생산하며, 어떤 두 회사도 같은 종류의 제품을 생산하지 않습니다. 각 도시는 한 개 이상의 공장을 가지고 있습니다. 각 공장은 도시들 중 하나에 지어져 있습니다. 같은 도시에 두 개 이상의 회사가 공장을 가지고 있을 수도 있습니다.</p>

<p>가끔 어떤 회사는 또다른 회사의 제품이 필요할 때가 있습니다. 회사 C<sub>A</sub>가 회사 C<sub>B</sub>의 제품이 필요하다고 가정해 봅시다. (C<sub>A</sub>≠C<sub>B</sub>) 이 경우, 그들은 C<sub>B</sub>에서 C<sub>A</sub>로 제품을 운반해야 합니다. 이를 위해 회사 C<sub>B</sub>의 아무 공장에서 회사 C<sub>A</sub>의 아무 공장으로 제품을 운반하면 됩니다. 그들은 공장들 사이의 거리를 최소화하기 위하여 공장들을 적절히 선택해야 합니다.</p>

<p>우선, 도시들의 수와 IOI 왕국의 도로의 정보가 주어집니다. 그 다음, Q개의 질의가 주어집니다. 각 질의는 다음과 같은 형태로 주어집니다: X<sub>j,0</sub>,⋯,X<sub>j,Sj−1</sub>번 도시들에 공장을 가지고 있는 회사 U<sub>j</sub>는 Y<sub>j,0</sub>,⋯,Y<sub>j,Tj−1</sub>번 도시들에 공장을 가지고 있는 회사 V<sub>j</sub>의 제품이 필요합니다. 각 질의마다, 제품을 운반하기 위해 필요한 최소 거리를 반환하는 프로그램을 작성하세요.</p>

### 입력 

 <p>첫 번째 줄에 두 개의 정수 N과 Q가 공백을 사이로 두고 주어집니다. 이는 IOI 왕국에 N개의 도시가 있고, 여러분의 프로그램에게 Q개의 질의가 주어진다는 것을 의미합니다.</p>

<p>다음 (N−1)개의 줄 중 (i+1)번째 줄 (0 ≤ i ≤ N−2)에는 세 개의 정수 A<sub>i</sub>, B<sub>i</sub>, D<sub>i</sub>가 공백을 사이로 두고 주어집니다. 이것은 도시 A<sub>i</sub>와 도시 B<sub>i</sub>를 잇는 길이가 D<sub>i</sub>인 도로가 있다는 것을 의미합니다.</p>

<p>다음 3Q개 줄 중에서 j번째 질의의 정보는 (3j+1)번째 줄부터 (3j+3)번째 줄까지 (0 ≤ j ≤ Q−1) 주어집니다.</p>

<p>(3j+1)번째 줄 (0 ≤ j ≤ Q−1)에는 두 개의 정수 S<sub>j</sub>와 T<sub>j</sub>가 공백을 사이로 두고 주어집니다. 이것은 회사 U<sub>j</sub>와 회사 V<sub>j</sub> 각각 S<sub>j</sub>개와 T<sub>j</sub>개의 도시에 공장을 두고 있다는 것을 의미합니다.</p>

<p>(3j+2)번째 줄 (0 ≤ j ≤ Q−1)에는 Sj개의 정수 X<sub>j,0</sub>,⋯,X<sub>j,Sj−1</sub>이 공백을 사이로 두고 주어집니다. 이것은 회사 Uj가 도시 X<sub>j,0</sub>,⋯,X<sub>j,Sj−1</sub>에 공장을 두고 있다는 것을 의미합니다.</p>

<p>(3j+3)번째 줄 (0 ≤ j ≤ Q−1)에는 T<sub>j</sub>개의 정수 Y<sub>j,0</sub>,⋯,Y<sub>j,Tj−1</sub>이 공백을 사이로 두고 주어집니다. 이것은 회사 V<sub>j</sub>가 도시 Y<sub>j,0</sub>,⋯,Y<sub>j,Tj−1</sub>에 공장을 두고 있다는 것을 의미합니다.</p>

<p>모든 입력 데이터는 다음 조건을 만족합니다.</p>

<ul>
	<li>2 ≤ N ≤ 500 000.</li>
	<li>1 ≤ Q ≤ 100 000.</li>
	<li>0 ≤ A<sub>i</sub> ≤ N − 1 (0 ≤ i ≤ N − 2).</li>
	<li>0 ≤ B<sub>i</sub> ≤ N − 1 (0 ≤ i ≤ N − 2).</li>
	<li>1 ≤ D<sub>i</sub> ≤ 100 000 000 (0 ≤ i ≤ N − 2).</li>
	<li>A<sub>i</sub> ≠ B<sub>i</sub> (1 ≤ i ≤ N − 2).</li>
	<li>여러분은 도로들을 통해 한 도시에서 다른 모든 도시로 이동할 수 있습니다.</li>
	<li>1 ≤ S<sub>j</sub> ≤ N − 1 (0 ≤ j ≤ Q − 1).</li>
	<li>0 ≤ X<sub>j,k</sub> ≤ N − 1 (0 ≤ j ≤ Q − 1, 0 ≤ k ≤ S<sub>j</sub> − 1).</li>
	<li>1 ≤ T<sub>j</sub> ≤ N − 1 (0 ≤ j ≤ Q − 1).</li>
	<li>0 ≤ Y<sub>j,k</sub> ≤ N − 1 (0 ≤ j ≤ Q − 1, 0 ≤ k ≤ Tj − 1).</li>
	<li>X<sub>j,0</sub>, X<sub>j,1</sub>, . . . , X<sub>j,Sj−1</sub>, Y<sub>j,0</sub>, Y<sub>j,1</sub>, . . . , Y<sub>j,Tj−1</sub> 은 서로 다릅니다 (0 ≤ j ≤ Q − 1).</li>
	<li>S<sub>0</sub> + S<sub>1</sub> + · · · + S<sub>Q−1</sub> ≤ 1 000 000.</li>
	<li>T<sub>0</sub> + T<sub>1</sub> + · · · + T<sub>Q−1</sub> ≤ 1 000 000.</li>
</ul>

### 출력 

 <p>각각의 질의에 대한 답을 한 줄에 하나씩 차례대로 출력합니다</p>

